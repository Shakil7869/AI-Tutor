<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure NCTB Chapters</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .class-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .tab {
            padding: 10px 30px;
            background: #ecf0f1;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .tab.active {
            background: #3498db;
            color: white;
        }
        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .chapter-card {
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            padding: 15px;
            background: #fdfdfd;
        }
        .chapter-header {
            margin-bottom: 15px;
        }
        .chapter-number {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: bold;
        }
        .chapter-title-bengali {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            margin: 5px 0;
        }
        .chapter-title-english {
            font-size: 14px;
            color: #34495e;
            font-style: italic;
        }
        .page-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .page-inputs label {
            font-size: 14px;
            color: #34495e;
        }
        .page-inputs input {
            width: 70px;
            padding: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            text-align: center;
        }
        .save-section {
            text-align: center;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 8px;
        }
        .save-btn {
            background-color: #27ae60;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .save-btn:hover {
            background-color: #229954;
        }
        .save-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .nav-links {
            text-align: center;
            margin-top: 30px;
        }
        .nav-links a {
            display: inline-block;
            margin: 0 15px;
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .nav-links a:hover {
            background-color: #2980b9;
        }
        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
        }
        .preset-buttons {
            text-align: center;
            margin-bottom: 20px;
        }
        .preset-btn {
            background-color: #e74c3c;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 10px;
            font-size: 14px;
        }
        .preset-btn:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öôÔ∏è Configure Chapter Page Ranges</h1>
        
        <div class="info-box">
            <strong>Instructions:</strong> Set the page numbers for each chapter in the NCTB mathematics textbook. 
            Students will only see these specific pages when studying each chapter. Make sure to check your PDF 
            page numbers carefully before setting the ranges.
        </div>

        <div class="class-tabs">
            <div class="tab active" onclick="switchClass(9)">Class 9 (‡¶®‡¶¨‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ)</div>
            <div class="tab" onclick="switchClass(10)">Class 10 (‡¶¶‡¶∂‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ)</div>
        </div>

        <div class="preset-buttons">
            <button class="preset-btn" onclick="loadSampleRanges()">üìã Load Sample Page Ranges</button>
            <button class="preset-btn" onclick="clearAllRanges()">üóëÔ∏è Clear All Ranges</button>
        </div>

        <div id="chaptersContainer">
            <div class="chapters-grid" id="chaptersGrid">
                <!-- Chapters will be populated by JavaScript -->
            </div>
        </div>

        <div class="save-section">
            <button class="save-btn" onclick="saveConfiguration()" id="saveBtn">
                üíæ Save Chapter Configuration
            </button>
            <div class="status" id="statusMessage"></div>
        </div>

        <div class="nav-links">
            <a href="/">üì§ Upload PDFs</a>
            <a href="/status">üìä Service Status</a>
        </div>
    </div>

    <script>
        const chapters = {{ chapters | tojson }};
        const currentRanges = {{ current_ranges | tojson }};
        let activeClass = 9;

        function initializeChapters() {
            renderChapters();
            loadCurrentRanges();
        }

        function switchClass(classLevel) {
            activeClass = classLevel;
            
            // Update tab appearance
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            renderChapters();
            loadCurrentRanges();
        }

        function renderChapters() {
            const grid = document.getElementById('chaptersGrid');
            grid.innerHTML = '';

            Object.entries(chapters).forEach(([chapterId, chapterInfo]) => {
                const card = document.createElement('div');
                card.className = 'chapter-card';
                card.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-number">Chapter ${chapterInfo.number}</div>
                        <div class="chapter-title-bengali">${chapterInfo.bengali}</div>
                        <div class="chapter-title-english">${chapterInfo.english}</div>
                    </div>
                    <div class="page-inputs">
                        <label>Start:</label>
                        <input type="number" id="start_${chapterId}" min="1" placeholder="1">
                        <label>End:</label>
                        <input type="number" id="end_${chapterId}" min="1" placeholder="20">
                        <label>pages</label>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function loadCurrentRanges() {
            const classKey = `class_${activeClass}`;
            const ranges = currentRanges[classKey] || {};

            Object.keys(chapters).forEach(chapterId => {
                const startInput = document.getElementById(`start_${chapterId}`);
                const endInput = document.getElementById(`end_${chapterId}`);
                
                if (ranges[chapterId]) {
                    startInput.value = ranges[chapterId].start || '';
                    endInput.value = ranges[chapterId].end || '';
                } else {
                    startInput.value = '';
                    endInput.value = '';
                }
            });
        }

        function loadSampleRanges() {
            // Sample page ranges for demonstration
            const sampleRanges = {
                'real_numbers': { start: 2, end: 20 },
                'sets_functions': { start: 21, end: 35 },
                'algebraic_expressions': { start: 36, end: 52 },
                'indices_logarithms': { start: 53, end: 68 },
                'linear_equations': { start: 69, end: 85 },
                'lines_angles_triangles': { start: 86, end: 105 },
                'practical_geometry': { start: 106, end: 120 },
                'circles': { start: 121, end: 140 },
                'trigonometric_ratios': { start: 141, end: 160 },
                'distance_height': { start: 161, end: 175 },
                'algebraic_ratios': { start: 176, end: 190 },
                'simultaneous_equations': { start: 191, end: 208 },
                'finite_series': { start: 209, end: 225 },
                'ratio_similarity_symmetry': { start: 226, end: 245 },
                'area_theorems': { start: 246, end: 265 },
                'mensuration': { start: 266, end: 285 },
                'statistics': { start: 286, end: 300 }
            };

            Object.entries(sampleRanges).forEach(([chapterId, range]) => {
                const startInput = document.getElementById(`start_${chapterId}`);
                const endInput = document.getElementById(`end_${chapterId}`);
                
                if (startInput && endInput) {
                    startInput.value = range.start;
                    endInput.value = range.end;
                }
            });

            showStatus('Sample page ranges loaded. Please adjust according to your actual PDF.', 'success');
        }

        function clearAllRanges() {
            Object.keys(chapters).forEach(chapterId => {
                const startInput = document.getElementById(`start_${chapterId}`);
                const endInput = document.getElementById(`end_${chapterId}`);
                
                if (startInput && endInput) {
                    startInput.value = '';
                    endInput.value = '';
                }
            });

            showStatus('All page ranges cleared.', 'success');
        }

        function saveConfiguration() {
            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';

            const chapterRanges = {};
            let hasErrors = false;

            Object.keys(chapters).forEach(chapterId => {
                const startInput = document.getElementById(`start_${chapterId}`);
                const endInput = document.getElementById(`end_${chapterId}`);
                
                const start = parseInt(startInput.value);
                const end = parseInt(endInput.value);
                
                if (start && end) {
                    if (start > end) {
                        showStatus(`Error in ${chapters[chapterId].english}: Start page cannot be greater than end page.`, 'error');
                        hasErrors = true;
                        return;
                    }
                    
                    chapterRanges[chapterId] = {
                        start: start,
                        end: end,
                        chapter_number: chapters[chapterId].number
                    };
                }
            });

            if (hasErrors) {
                saveBtn.disabled = false;
                saveBtn.textContent = 'üíæ Save Chapter Configuration';
                return;
            }

            fetch('/configure', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    class_level: activeClass,
                    chapter_ranges: chapterRanges
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showStatus(data.message + ` (${Object.keys(chapterRanges).length} chapters configured)`, 'success');
                    // Update current ranges
                    currentRanges[`class_${activeClass}`] = chapterRanges;
                } else {
                    showStatus('Save failed: ' + data.error, 'error');
                }
            })
            .catch(error => {
                showStatus('Save failed: ' + error.message, 'error');
            })
            .finally(() => {
                saveBtn.disabled = false;
                saveBtn.textContent = 'üíæ Save Chapter Configuration';
            });
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            statusDiv.style.display = 'block';
            
            // Auto-hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Initialize on page load
        window.addEventListener('load', initializeChapters);
    </script>
</body>
</html>
